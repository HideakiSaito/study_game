<html>
<head>
  <meta charset="utf-8" />
  <title>マウスのフリック操作で星を動す</title>
  <style>canvas { background-color: #000000; }</style>
</head>
<body>
<canvas id="canvas" width="600" height="600"></canvas>
<script>
var x, y; // 画像の位置
var vx, vy; // 画像の速度
var half_w, half_h; // 画像の幅の半分と高さの半分
var cx, cy; // キャンバスの中心
var mousedownTime; // マウスダウン時の時刻
// 描画コンテキストを取得
var canvas = document.getElementById("canvas");
var context = canvas.getContext("2d");
cx = canvas.width/2; // キャンバスの中心を求める
cy = canvas.height/2;
// 画面クリア時の色を黒＆やや透明に設定
context.fillStyle = "rgba(0, 0, 0, 0.1)";
context.rect(0, 0, canvas.width,canvas.height);
// 画像の読み込み
var image = new Image();
image.src = "star.png";
// 画像の読み込みが完了するとonloadイベントが発生するので
// 同イベントに対するイベントハンドラを設定

image.onload = function () {
  // キャンバスの中心に画像を描画
  half_w = image.width/2; // 画像の幅の半分を求める
  half_h = image.height/2; // 画像の高さの半分を求める
  // 画像の位置を設定
  x = cx - half_w;
  y = cy - half_h;
  context.drawImage(image, x, y); // 画像を描画
  // マウスダウン時のイベントハンドラを設定
  canvas.addEventListener("mousedown", OnMousedown, false);
}

// 画像を動かす関数
var move = function() {
  context.fill(); // 画面をクリア
  context.drawImage(image, x, y); // 画像を描画
  // 画像の位置を更新
  x = x + vx;
  y = y + vy;
  // キャンバスの端に来たら向きを反転
  if(x < -half_w || x > cx*2 - half_w) { vx = -vx; }
  if(y < -half_h || y > cy*2 - half_h) { vy = -vy; }
}

// マウスダウン時の処理
var OnMousedown = function(e){
  var rect = e.target.getBoundingClientRect();
  // マウスの座標を取得
  mouseX = e.clientX - rect.left;
  mouseY = e.clientY - rect.top;
  // 画像の上にマウスダウンされたかをチェック
  if(mouseX < x + image.width && mouseX > x &&
    mouseY < y + image.height && mouseY > y) {
    // マウスアップ時のイベントハンドラを設定
    canvas.addEventListener("mouseup", OnMouseup, false);
    mousedownTime = new Date();
  }
}

// マウスアップ時の処理
var OnMouseup = function(e){
  var rect = e.target.getBoundingClientRect();
  // マウスの座標を取得
  mouseX = e.clientX - rect.left;
  mouseY = e.clientY - rect.top;
  var th = Math.atan2(mouseY - cy, mouseX - cx);
  var d = Math.sqrt((cx - mouseX) * (cx - mouseX) + (cy - mouseY) * (cy - mouseY));
  var mouseupTime = new Date();
  vx = 16 * Math.cos(th) * d / (mouseupTime - mousedownTime);
  vy = 16 * Math.sin(th) * d / (mouseupTime - mousedownTime);
  setInterval(move, 20); // 画像の移動を開始
  // すべてのイベントハンドラを削除
  canvas.removeEventListener("mousedown", OnMousedown);
  canvas.removeEventListener("mouseup", OnMouseup);
}
</script>
</body>
</html>