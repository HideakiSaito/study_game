<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>マウスの動きに合わせて画像を回転</title>
  <style>canvas { background-color: #000000; }</style>
</head>
<body onload="draw()">
<canvas id="canvas" width="400" height="400"></canvas>
<script>
var cx, cy; // キャンバスの中心
var px, py; // 画像の中心

function draw() {
  // 描画コンテキストを取得
  var canvas = document.getElementById("canvas");
  var context = canvas.getContext("2d");
  // キャンバスの中心
  cx = canvas.width / 2;
  cy = canvas.height / 2;
  // 画像の読み込み
  var image = new Image();
  image.src = "image01.jpg";
  image.onload = function () {
    // 画像の中心
    px = image.width / 2;
    py = image.height / 2;
    // キャンバスの中心に描画
    context.drawImage(image, cx-px, cy-py);
    // ピクセルデータを取得
    var srcImage = context.getImageData(cx-px, cy-py, image.width, image.height);
    // マウスドラッグ
    canvas.onmousemove = function(e){
      // 座標を調整
      var rect = e.target.getBoundingClientRect();
      mouseX = e.clientX - rect.left;
      mouseY = e.clientY - rect.top;
      // 回転後画像
      var dstImage = context.createImageData(canvas. width, canvas.height);
      // マウス位置から角度を計算
      var th = Math.atan2(mouseY-cy, mouseX-cx);
      rotateImage(srcImage, dstImage, th); // 回転
      // 回転後の画像を表示
      context.putImageData(dstImage, 0, 0);
    }
  }
}
//--------------------------------------------------
// 回転
//--------------------------------------------------
function rotateImage(srcImage, dstImage, th) {
  var srcData = srcImage.data; // 元のピクセルデータ
  var dstData = dstImage.data; // 回転後のピクセルデータ
  var sw = srcImage.width; // 元の画像の幅
  var sh = srcImage.height; // 元の画像の高さ
  var dw = dstImage.width; // 回転後の画像の幅
  var x, y; // 元の座標
  var dx, dy; // 回転後の座標
  var i, di; // 配列のインデックス
  for (x = 0; x < sw; x++) {
    for (y = 0; y < sh; y++) {
      // 回転後の座標を計算
      dx = Math.floor((x - px) * Math.cos(th) - (y - py) * Math.sin(th) + cx);
      dy = Math.floor((x - px) * Math.sin(th) + (y - py) * Math.cos(th) + cy);
      // 配列のインデックス
      i = (sw * y + x) * 4; // 回転前
      di = (dw * dy + dx) * 4; // 回転後
      // 色を置き換え
      dstData[di + 0] = srcData[i + 0];
      dstData[di + 1] = srcData[i + 1];
      dstData[di + 2] = srcData[i + 2];
      dstData[di + 3] = 255;
    }
  }
}
</script>
</body>
</html>